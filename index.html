<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Urban Archive</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #f8f9fa;
      --card: #ffffff;
      --text: #212529;
      --btn: #0077b6;
      --btn-hover: #023e7d;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
      color: var(--text);
      padding: 16px;
      margin: 0;
      min-height: 100vh;
    }
    .container { max-width: 600px; margin: 0 auto; }
    .header {
      text-align: center;
      margin-bottom: 24px;
    }
    .header h2 {
      font-weight: 700;
      font-size: 28px;
      margin: 0;
      background: linear-gradient(90deg, #0077b6, #00b4d8);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .product-grid { display: grid; gap: 16px; }
    .product-card img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 12px;
    }
    .product-card h3 {
      font-size: 18px;
      margin: 8px 0 6px;
    }
    .product-card p.price {
      font-weight: 700;
      color: #0077b6;
      margin: 4px 0;
    }
    button {
      background: var(--btn);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 10px;
      width: 100%;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: var(--btn-hover);
    }
    button.secondary {
      background: #e9ecef;
      color: #495057;
    }
    button.secondary:hover {
      background: #dee2e6;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    .cart-item button {
      width: auto;
      padding: 4px 10px;
      font-size: 14px;
      border-radius: 6px;
    }
    #cart-items { margin-top: 8px; }
    .step { display: none; }
    .step.active { display: block; }
  </style>
</head>
<body>
  <div class="container">
    <!-- –®–∞–≥ 1: –¢–æ–≤–∞—Ä—ã -->
    <div id="step-products" class="step active">
      <div class="header">
        <h2>üõç Urban Archive</h2>
      </div>
      <div id="product-list" class="product-grid"></div>
      <button id="go-to-cart" class="secondary" style="display:none;">üõí –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>

    <!-- –®–∞–≥ 2: –ö–æ—Ä–∑–∏–Ω–∞ -->
    <div id="step-cart" class="step">
      <button class="secondary" onclick="showStep('products')">‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º</button>
      <div class="card">
        <h3>üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
        <div id="cart-items">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
        <div id="cart-total" style="font-weight:700; margin-top:12px;"></div>
        <button onclick="showStep('checkout')" id="checkout-btn" style="margin-top:16px; display:none;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>

    <!-- –®–∞–≥ 3: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ -->
    <div id="step-checkout" class="step">
      <button class="secondary" onclick="showStep('cart')">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      <div class="card">
        <h3>üì¶ –î–æ—Å—Ç–∞–≤–∫–∞</h3>
        <input type="text" id="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤, –∏–Ω–¥–µ–∫—Å">
        <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è –∫—É—Ä—å–µ—Ä–∞">
        <input type="email" id="email" placeholder="Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">

        <h3 style="margin-top:20px;">üí≥ –û–ø–ª–∞—Ç–∞</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button type="button" class="secondary" onclick="setPayment('cash')" id="btn-cash">–ù–∞–ª–∏—á–Ω—ã–µ</button>
          <button type="button" class="secondary" onclick="setPayment('card')" id="btn-card">–ö–∞—Ä—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</button>
        </div>
        <p id="payment-note" style="font-size:14px; color:#666; margin:8px 0;"></p>

        <button onclick="submitOrder()" id="submit-btn" style="margin-top:20px;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>

    <!-- –®–∞–≥ 4: –£—Å–ø–µ—Ö -->
    <div id="step-success" class="step">
      <div class="card" style="text-align:center; padding:32px;">
        <h2>üéâ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</h2>
        <p style="margin:16px 0;">–°–∫–æ—Ä–æ —è —Å —Ç–æ–±–æ–π —Å–≤—è–∂—É—Å—å –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.</p>
        <button onclick="location.reload()" style="margin-top:20px;">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω</button>
      </div>
    </div>
  </div>

  <script>
    // üîπ –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–ï –ú–ï–°–¢–û, –ö–£–î–ê –î–û–ë–ê–í–õ–Ø–ï–®–¨/–£–î–ê–õ–Ø–ï–®–¨ –¢–û–í–ê–†–´
    const products = [
      {
        id: "jordan-sweatshirt",
        name: "Jordan –°–≤–∏—Ç—à–æ—Ç (Asia Fit)",
        price: 8200,
        description: "‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª, –ø—Ä–æ–≤–µ—Ä–µ–Ω –ª–∏—á–Ω–æ",
        sizes: ["S (44‚Äì46)", "M (48‚Äì50)", "L (50‚Äì52)", "XL (52‚Äì54)"],
        image: "https://images.unsplash.com/photo-1521321205814-9d6749c7048a?auto=format&fit=crop&w=600&h=400"
      },
      {
        id: "nike-hoodie",
        name: "Nike –¢–æ–ª—Å—Ç–æ–≤–∫–∞ Oversize",
        price: 9500,
        description: "üî• –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è",
        sizes: ["M", "L", "XL"],
        image: "https://images.unsplash.com/photo-1542252975-438d89a0e914?auto=format&fit=crop&w=600&h=400"
      }
      // üëà –î–æ–±–∞–≤–ª—è–π —Å—é–¥–∞ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–π –∏ –º–µ–Ω—è–π –¥–∞–Ω–Ω—ã–µ
    ];

    // üõí –ö–æ—Ä–∑–∏–Ω–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏)
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let selectedPayment = 'cash'; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

    // --- –§—É–Ω–∫—Ü–∏–∏ ---
    function renderProducts() {
      const el = document.getElementById("product-list");
      el.innerHTML = products.map(p => `
        <div class="card product-card" onclick="openProduct('${p.id}')">
          <img src="${p.image}" alt="${p.name}">
          <h3>${p.name}</h3>
          <p class="price">${p.price.toLocaleString()} ‚ÇΩ</p>
          <p>${p.description}</p>
        </div>
      `).join('');
      updateCartBadge();
    }

    function openProduct(id) {
      const p = products.find(x => x.id === id);
      if (!p) return;

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —à–∞–≥ (–¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞)
      window.history.pushState({ step: 'product' }, '', '#product');

      document.body.innerHTML = `
        <div class="container">
          <button class="secondary" onclick="history.back()">‚Üê –ù–∞–∑–∞–¥</button>
          <div class="card">
            <img src="${p.image}" style="width:100%; height:240px; object-fit:cover; border-radius:12px; margin-bottom:16px;">
            <h2>${p.name}</h2>
            <p>${p.description}</p>
            <p class="price">${p.price.toLocaleString()} ‚ÇΩ</p>
            
            <label>–†–∞–∑–º–µ—Ä:</label>
            <select id="size">${p.sizes.map(s => `<option>${s}</option>`).join('')}</select>
            
            <button onclick="addToCart('${p.id}', document.getElementById('size').value)">üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
          <div id="mini-cart" class="card" style="margin-top:16px;"></div>
        </div>
      `;
      updateMiniCart();
    }

    function addToCart(productId, size) {
      const product = products.find(p => p.id === productId);
      if (!product) return;

      cart.push({
        id: product.id,
        name: product.name,
        size: size,
        price: product.price
      });
      localStorage.setItem('cart', JSON.stringify(cart));
      updateMiniCart();
      alert("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É!");
    }

    function updateMiniCart() {
      const el = document.getElementById("mini-cart");
      if (!el) return;

      if (cart.length === 0) {
        el.innerHTML = "<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
      } else {
        const total = cart.reduce((s, i) => s + i.price, 0);
        el.innerHTML = `
          <h3>üõí –ö–æ—Ä–∑–∏–Ω–∞ (${cart.length})</h3>
          <div id="cart-items-mini"></div>
          <p><strong>–ò—Ç–æ–≥–æ: ${total.toLocaleString()} ‚ÇΩ</strong></p>
          <button onclick="showStep('cart')" style="margin-top:10px;">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        `;
        renderCartItems(document.getElementById("cart-items-mini"));
      }
    }

    function updateCartBadge() {
      const btn = document.getElementById("go-to-cart");
      if (cart.length > 0) {
        btn.style.display = 'block';
        btn.textContent = `üõí –ö–æ—Ä–∑–∏–Ω–∞ (${cart.length})`;
      } else {
        btn.style.display = 'none';
      }
    }

    function renderCartItems(container) {
      if (cart.length === 0) {
        container.innerHTML = "–ü—É—Å—Ç–æ";
        return;
      }
      container.innerHTML = cart.map((item, i) => `
        <div class="cart-item">
          <div>
            <strong>${item.name}</strong><br>
            <small>${item.size} ‚Äî ${item.price} ‚ÇΩ</small>
          </div>
          <button onclick="removeFromCart(${i})">‚úï</button>
        </div>
      `).join('');
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartUI();
      updateMiniCart();
      updateCartBadge();
    }

    function updateCartUI() {
      const itemsEl = document.getElementById("cart-items");
      const totalEl = document.getElementById("cart-total");
      const btn = document.getElementById("checkout-btn");

      if (cart.length === 0) {
        itemsEl.innerHTML = "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞";
        totalEl.textContent = "";
        btn.style.display = "none";
      } else {
        renderCartItems(itemsEl);
        const total = cart.reduce((s, i) => s + i.price, 0);
        totalEl.innerHTML = `<strong>–ò—Ç–æ–≥–æ: ${total.toLocaleString()} ‚ÇΩ</strong>`;
        btn.style.display = "block";
      }
    }

    function setPayment(method) {
      selectedPayment = method;
      document.querySelectorAll('#btn-cash, #btn-card').forEach(b => b.classList.remove('secondary'));
      document.getElementById('btn-' + method).classList.add('secondary');
      document.getElementById('payment-note').textContent = 
        method === 'cash' ? '–û–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∫—É—Ä—å–µ—Ä—É' : '–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏';
    }

    function showStep(step) {
      document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
      document.getElementById('step-' + step).classList.add('active');
      window.scrollTo(0, 0);
      if (step === 'cart') updateCartUI();
      if (step === 'products') renderProducts();
    }

    function submitOrder() {
      const addr = document.getElementById("address").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (cart.length === 0) {
        alert("‚ö†Ô∏è –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞");
        return;
      }
      if (!addr || !phone) {
        alert("‚ö†Ô∏è –£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –∏ —Ç–µ–ª–µ—Ñ–æ–Ω");
        return;
      }

      const order = {
        items: cart,
        address: addr,
        phone: phone,
        email: document.getElementById("email").value.trim() || null,
        payment: selectedPayment,
        timestamp: new Date().toISOString()
      };

      // üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–±–µ –≤ Telegram
      Telegram.WebApp.sendData(JSON.stringify(order));
      
      // üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ WebApp –∑–∞–∫—Ä–æ–µ—Ç—Å—è)
      const history = JSON.parse(localStorage.getItem('orderHistory') || '[]');
      history.push(order);
      localStorage.setItem('orderHistory', JSON.stringify(history));

      // ‚úÖ –ü–æ–∫–∞–∑ —É—Å–ø–µ—Ö–∞
      showStep('success');
    }

    // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ –±—Ä–∞—É–∑–µ—Ä–µ
    window.addEventListener('popstate', (e) => {
      if (e.state && e.state.step === 'product') {
        showStep('products');
      }
    });

    // –ó–∞–ø—É—Å–∫
    renderProducts();
    updateCartUI();
    updateCartBadge();
  </script>
</body>
</html>
